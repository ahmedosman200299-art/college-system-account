<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ù†Ø¸Ø§Ù… Ø§Ù„ÙƒÙ„ÙŠØ© Ø§Ù„Ù…ÙˆØ­Ø¯ - Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø³Ø­Ø§Ø¨ÙŠØ© Ø§Ù„Ù…Ø²Ø¯ÙˆØ¬Ø©</title>
    <style>
        /* Ø­Ø§ÙØ¸Øª Ø¹Ù„Ù‰ Ù†ÙØ³ Ø§Ù„ØªØµÙ…ÙŠÙ… Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ 100% */
        :root { --dark: #0f172a; --gold: #d4af37; --bg: #f8fafc; --success: #10b981; --danger: #e11d48; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; margin: 0; background: var(--bg); display: flex; min-height: 100vh; overflow-x: hidden; }
        #receipt-print, #report-print { display: none; }
        @media print {
            body * { visibility: hidden; }
            #receipt-print, #receipt-print * { visibility: visible; }
            #receipt-print { display: block; position: absolute; inset: 0; padding: 30px; border: 2px solid #000; z-index: 9999; background: white; }
            .print-report-mode #report-print, .print-report-mode #report-print * { visibility: visible; }
            .print-report-mode #report-print { display: block; position: absolute; inset: 0; padding: 20px; z-index: 9999; background: white; }
            .print-row { display: flex; justify-content: space-between; margin: 15px 0; border-bottom: 1px solid #ccc; padding-bottom: 5px; }
        }
        .sidebar { width: 260px; background: var(--dark); color: white; height: 100vh; position: fixed; right: 0; top: 0; display: flex; flex-direction: column; z-index: 999; }
        .sidebar-header { padding: 25px; font-size: 1.2rem; font-weight: bold; color: var(--gold); text-align: center; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .nav-item { padding: 15px 25px; cursor: pointer; border-bottom: 1px solid rgba(255,255,255,0.05); transition: 0.2s; }
        .nav-item:hover { background: rgba(255,255,255,0.1); padding-right: 35px; color: var(--gold); }
        .main-content { margin-right: 260px; padding: 30px; width: calc(100% - 260px); }
        .section { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); margin-bottom: 25px; }
        #auth-screen { position: fixed; inset: 0; background: var(--dark); display: flex; justify-content: center; align-items: center; z-index: 10000; }
        .auth-card { background: white; padding: 30px; border-radius: 12px; width: 450px; text-align: center; border-top: 6px solid var(--gold); }
        input, select, textarea { padding: 10px; margin: 8px 0; border: 1px solid #cbd5e1; border-radius: 6px; width: 100%; box-sizing: border-box; }
        .btn { padding: 10px 18px; border-radius: 6px; border: none; cursor: pointer; font-weight: 600; display: inline-flex; align-items: center; justify-content: center; gap: 8px; transition: 0.2s; }
        .btn-gold { background: var(--gold); color: var(--dark); }
        .btn-dark { background: var(--dark); color: white; }
        .btn-google { background: white; border: 1px solid #dadce0; width: 100%; margin-top: 10px; }
        .dept-filters { display: flex; gap: 10px; margin: 15px 0; flex-wrap: wrap; }
        .btn-filter { padding: 8px 15px; border: 1px solid var(--dark); background: white; border-radius: 5px; cursor: pointer; }
        .btn-filter.active { background: var(--dark); color: white; }
        .hidden { display: none !important; }
        table { width: 100%; border-collapse: collapse; margin-top: 15px; font-size: 0.9rem; }
        th, td { padding: 10px; border: 1px solid #e2e8f0; text-align: center; }
        th { background: #f1f5f9; }
        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.8); display: flex; justify-content: center; align-items: center; z-index: 11000; }
        .modal-content { background: white; padding: 25px; border-radius: 10px; width: 95%; max-width: 600px; max-height: 80vh; overflow-y: auto; }
        .pending-card { background: #fffbeb; border: 1.5px solid var(--gold); padding: 15px; border-radius: 8px; margin: 10px 0; display: flex; justify-content: space-between; align-items: center; text-align: right; }
        .welcome-msg { font-size: 1.8rem; font-weight: bold; color: var(--dark); margin-bottom: 20px; border-bottom: 2px solid var(--gold); padding-bottom: 10px; }
        .system-intro { background: linear-gradient(45deg, var(--dark), #1e293b); color: white; padding: 30px; border-radius: 12px; margin-bottom: 20px; text-align: center; border: 2px solid var(--gold); }
        .status-badge { padding: 5px 10px; border-radius: 5px; font-weight: bold; }
        .st-registered { background: #dcfce7; color: #166534; }
        .st-not-registered { background: #fee2e2; color: #991b1b; }
    </style>
</head>
<body>

<div id="receipt-print">
    <h2 style="text-align: center;">Ø¥ÙŠØµØ§Ù„ Ù…Ø§Ù„ÙŠ Ù…Ø¹ØªÙ…Ø¯ - Ø§Ù„ÙƒÙ„ÙŠØ© Ø§Ù„Ù…ÙˆØ­Ø¯Ø©</h2>
    <hr>
    <div style="line-height: 2; font-size: 1.2rem;">
        <div class="print-row"><span>Ø±Ù‚Ù… Ø§Ù„Ø·Ø§Ù„Ø¨:</span> <b id="p-id"></b></div>
        <div class="print-row"><span>Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨:</span> <b id="p-name"></b></div>
        <div class="print-row"><span>Ø§Ù„Ù‚Ø³Ù…:</span> <b id="p-dept"></b></div>
        <div class="print-row"><span>Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ©:</span> <b>Ù…Ø³Ø¬Ù„ Ù…Ø¹ØªÙ…Ø¯</b></div>
        <hr>
        <div class="print-row"><span>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø±Ø³ÙˆÙ…:</span> <b id="p-total"></b> Ø¬Ù†ÙŠÙ‡</div>
        <div class="print-row"><span>Ø§Ù„Ù…Ø¯ÙÙˆØ¹:</span> <b id="p-paid"></b> Ø¬Ù†ÙŠÙ‡</div>
        <div class="print-row"><span>Ø­Ø§Ù„Ø© Ø§Ù„Ø³Ø¯Ø§Ø¯:</span> <b style="color:green">ØªÙ… Ø§Ù„Ø³Ø¯Ø§Ø¯ ÙˆØ§Ù„ØªØ£ÙƒÙŠØ¯ âœ…</b></div>
    </div>
    <hr>
    <p style="text-align: center; margin-top: 50px;">ØªÙˆÙ‚ÙŠØ¹ Ø§Ù„Ù…Ø­Ø§Ø³Ø¨ / Ø§Ù„Ø®ØªÙ…</p>
    <p>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©: <span id="p-date"></span></p>
</div>

<div id="report-print">
    <h2 style="text-align: center; color: var(--dark)">ØªÙ‚Ø±ÙŠØ± Ø¥Ø¯Ø§Ø±ÙŠ Ø´Ø§Ù…Ù„</h2>
    <div style="text-align: center; margin-bottom: 20px;">
        <span id="rep-header-dept"></span> | <span id="rep-header-date"></span>
    </div>
    <table border="1" style="width: 100%; border-collapse: collapse;">
        <thead>
            <tr style="background: #eee;">
                <th>Ø§Ù„Ø±Ù‚Ù…</th><th>Ø§Ù„Ø§Ø³Ù…</th><th>Ø§Ù„Ù‚Ø³Ù…</th><th>Ø§Ù„ØªØ®ØµØµ</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th><th>Ø§Ù„Ù…Ø§Ù„ÙŠØ©</th>
            </tr>
        </thead>
        <tbody id="rep-print-body"></tbody>
    </table>
    <br>
    <p>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ù„Ø§Ø¨ ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„ØªÙ‚Ø±ÙŠØ±: <b id="rep-count"></b></p>
</div>

<div id="auth-screen">
    <div class="auth-card">
        <div class="welcome-msg">Ù…Ø±Ø­Ø¨Ø§ Ø¨Ùƒ ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø³Ø­Ø§Ø¨ÙŠ Ø§Ù„Ù…Ø²Ø¯ÙˆØ¬</div>
        <div id="login-box">
            <input type="text" id="login-email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ">
            <input type="password" id="login-pass" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±">
            <button class="btn btn-gold" style="width: 100%;" onclick="login()">Ø¯Ø®ÙˆÙ„ Ù„Ù„Ù†Ø¸Ø§Ù…</button>
            <button class="btn btn-google" onclick="googleAuth()">
                <img src="https://www.google.com/favicon.ico" width="16"> Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨ÙˆØ§Ø³Ø·Ø© Google
            </button>
            <hr>
            <div style="display: flex; justify-content: space-between;">
                <button class="btn" onclick="showAuthAction('register-box')">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</button>
                <button class="btn" onclick="showAuthAction('forgot-box')">Ù†Ø³ÙŠØª ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±ØŸ</button>
            </div>
            <button class="btn btn-dark" style="width: 100%; margin-top:10px" onclick="openAdminPanel()">ğŸ›¡ï¸ Ù„ÙˆØ­Ø© Ø§Ù„Ø£Ø¯Ù…Ù†</button>
        </div>

        <div id="register-box" class="hidden">
            <h3>Ø·Ù„Ø¨ Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯</h3>
            <input type="text" id="reg-name" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„">
            <input type="email" id="reg-email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ">
            <input type="password" id="reg-pass" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±">
            <button class="btn btn-gold" style="width:100%" onclick="submitSupportRequest('ØªÙØ¹ÙŠÙ„ Ø­Ø³Ø§Ø¨')">Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ ØªÙØ¹ÙŠÙ„</button>
            <button class="btn" onclick="hideAuthAction()">Ø±Ø¬ÙˆØ¹</button>
        </div>

        <div id="forgot-box" class="hidden">
            <h3>Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø­Ø³Ø§Ø¨</h3>
            <input type="email" id="f-email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ">
            <button class="btn btn-gold" style="width:100%" onclick="submitSupportRequest('Ù†Ø³ÙŠØª ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±')">Ø·Ù„Ø¨ ÙƒÙˆØ¯ Ø§Ù„Ø§Ø³ØªØ¹Ø§Ø¯Ø©</button>
            <button class="btn" onclick="hideAuthAction()">Ø±Ø¬ÙˆØ¹</button>
        </div>
    </div>
</div>

<div id="admin-modal" class="modal hidden">
    <div class="modal-content">
        <h2>ğŸ›¡ï¸ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù†Ø¸Ø§Ù… - Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„ÙˆØ§Ø±Ø¯</h2>
        <div id="requests-list"></div>
        <button class="btn btn-dark" style="width:100%; margin-top:20px" onclick="toggle('admin-modal')">Ø¥ØºÙ„Ø§Ù‚</button>
    </div>
</div>

<div id="report-modal" class="modal hidden">
    <div class="modal-content">
        <h3 style="color: var(--gold)">ğŸ“Š Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ©</h3>
        <p>Ø§Ø®ØªØ± Ø§Ù„Ù…Ø¹Ø§ÙŠÙŠØ± Ù„Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„ØªÙ‚Ø±ÙŠØ±:</p>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
            <div>
                <label>Ø§Ù„Ù‚Ø³Ù…:</label>
                <select id="rep-dept-select" onchange="syncMajors('rep-major-select', 'rep-dept-select')">
                    <option value="Ø§Ù„ÙƒÙ„">ÙƒÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…</option>
                    <option value="ØªÙ‚Ø§Ù†Ø© Ù†Ø¸Ù… Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª">ØªÙ‚Ø§Ù†Ø© Ù†Ø¸Ù… Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª</option>
                    <option value="Ø§Ù„Ù‡Ù†Ø¯Ø³Ø© Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠØ©">Ø§Ù„Ù‡Ù†Ø¯Ø³Ø© Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠØ©</option>
                    <option value="Ø§Ù„Ù‡Ù†Ø¯Ø³Ø© Ø§Ù„Ù…ÙŠÙƒØ§Ù†ÙŠÙƒÙŠØ©">Ø§Ù„Ù‡Ù†Ø¯Ø³Ø© Ø§Ù„Ù…ÙŠÙƒØ§Ù†ÙŠÙƒÙŠØ©</option>
                </select>
            </div>
            <div>
                <label>Ø§Ù„ØªØ®ØµØµ:</label>
                <select id="rep-major-select">
                    <option value="Ø§Ù„ÙƒÙ„">ÙƒÙ„ Ø§Ù„ØªØ®ØµØµØ§Øª</option>
                </select>
            </div>
            <div>
                <label>Ø§Ù„Ø­Ø§Ù„Ø©:</label>
                <select id="rep-status-select">
                    <option value="Ø§Ù„ÙƒÙ„">Ø§Ù„ÙƒÙ„</option>
                    <option value="Ù…Ø³Ø¬Ù„">Ù…Ø³Ø¬Ù„ ÙÙ‚Ø·</option>
                    <option value="ØºÙŠØ± Ù…Ø³Ø¬Ù„">ØºÙŠØ± Ù…Ø³Ø¬Ù„ ÙÙ‚Ø·</option>
                </select>
            </div>
        </div>
        <div style="margin-top: 20px; display: flex; gap: 10px;">
            <button class="btn btn-gold" onclick="generateAndPrintReport()">Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ±</button>
            <button class="btn btn-dark" onclick="toggle('report-modal')">Ø¥Ù„ØºØ§Ø¡</button>
        </div>
    </div>
</div>

<div class="sidebar hidden" id="sidebar">
    <div class="sidebar-header">Ù†Ø¸Ø§Ù… Ø§Ù„ÙƒÙ„ÙŠØ© Ø§Ù„Ù…ÙˆØ­Ø¯</div>
    <div class="nav-item" onclick="showSec('home-sec')">ğŸ  Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</div>
    <div class="nav-item" onclick="showSec('reg-sec')">ğŸ‘¤ Ù…ÙƒØªØ¨ Ø§Ù„Ù…Ø³Ø¬Ù„</div>
    <div class="nav-item" onclick="showSec('fin-sec')">ğŸ’° Ù…ÙƒØªØ¨ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª</div>
    <div class="nav-item" style="margin-top:auto; color:#ff4444" onclick="location.reload()">ğŸšª Ø®Ø±ÙˆØ¬</div>
</div>

<div class="main-content hidden" id="content">
    <div id="home-sec" class="section">
        <div class="system-intro">
            <h1>Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù†Ø¸Ø§Ù… Ø§Ù„ÙƒÙ„ÙŠØ© Ø§Ù„Ù…ÙˆØ­Ø¯</h1>
            <p>Ù†Ø¸Ø§Ù… Ø³Ø­Ø§Ø¨ÙŠ Ù…Ø±ØªØ¨Ø· Ø¨Ù€ SQL Ùˆ Google Sheets Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø§Ø¨.</p>
        </div>
        <h2 style="color: var(--dark)">Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø§Ù„Ø¹Ø§Ù…</h2>
        <input type="text" id="h-search" placeholder="Ø¨Ø­Ø« Ø¨Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨ Ø£Ùˆ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø¬Ø§Ù…Ø¹ÙŠ..." onkeyup="render()">
        <table>
            <thead><tr><th>Ø§Ù„Ø±Ù‚Ù…</th><th>Ø§Ù„Ø§Ø³Ù…</th><th>Ø§Ù„Ù‚Ø³Ù…</th><th>Ø­Ø§Ù„Ø© Ø§Ù„ØªØ³Ø¬ÙŠÙ„</th></tr></thead>
            <tbody id="h-tbody"></tbody>
        </table>
    </div>

    <div id="reg-sec" class="section hidden">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
            <h1 class="welcome-msg" style="border:none; margin:0">ğŸ‘¤ Ù…ÙƒØªØ¨ Ø§Ù„Ù…Ø³Ø¬Ù„</h1>
            <div style="display:flex; gap:10px">
                <button class="btn btn-gold" onclick="toggle('add-box')">â• Ø¥Ø¶Ø§ÙØ© Ø·Ø§Ù„Ø¨</button>
                <button class="btn btn-dark" onclick="openReportModal()">ğŸ“„ ØªÙ‚Ø§Ø±ÙŠØ± Ø¥Ø¯Ø§Ø±ÙŠØ©</button>
            </div>
        </div>
        <div class="dept-filters">
            <button class="btn-filter active" onclick="filterByDept('Ø§Ù„ÙƒÙ„', this, 'reg')">Ø§Ù„ÙƒÙ„</button>
            <button class="btn-filter" onclick="filterByDept('ØªÙ‚Ø§Ù†Ø© Ù†Ø¸Ù… Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª', this, 'reg')">Ù†Ø¸Ù… Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª</button>
            <button class="btn-filter" onclick="filterByDept('Ø§Ù„Ù‡Ù†Ø¯Ø³Ø© Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠØ©', this, 'reg')">ÙƒÙ‡Ø±Ø¨Ø§Ø¡</button>
            <button class="btn-filter" onclick="filterByDept('Ø§Ù„Ù‡Ù†Ø¯Ø³Ø© Ø§Ù„Ù…ÙŠÙƒØ§Ù†ÙŠÙƒÙŠØ©', this, 'reg')">Ù…ÙŠÙƒØ§Ù†ÙŠÙƒØ§</button>
        </div>
        <div id="add-box" class="hidden" style="background:#f1f5f9; padding:20px; border-radius:10px; margin-bottom:20px;">
            <h3>ØªØ³Ø¬ÙŠÙ„ Ø·Ø§Ù„Ø¨ Ø¬Ø¯ÙŠØ¯</h3>
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
                <input type="text" id="s-name" placeholder="Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨">
                <select id="s-dept" onchange="syncMajors('s-major', 's-dept')">
                    <option value="">Ø§Ù„Ù‚Ø³Ù…</option>
                    <option value="ØªÙ‚Ø§Ù†Ø© Ù†Ø¸Ù… Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª">ØªÙ‚Ø§Ù†Ø© Ù†Ø¸Ù… Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª</option>
                    <option value="Ø§Ù„Ù‡Ù†Ø¯Ø³Ø© Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠØ©">Ø§Ù„Ù‡Ù†Ø¯Ø³Ø© Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠØ©</option>
                    <option value="Ø§Ù„Ù‡Ù†Ø¯Ø³Ø© Ø§Ù„Ù…ÙŠÙƒØ§Ù†ÙŠÙƒÙŠØ©">Ø§Ù„Ù‡Ù†Ø¯Ø³Ø© Ø§Ù„Ù…ÙŠÙƒØ§Ù†ÙŠÙƒÙŠØ©</option>
                </select>
                <select id="s-major"></select>
            </div>
            <div style="display:grid; grid-template-columns: repeat(4, 1fr); gap:10px; margin-top:10px;">
                <input type="number" id="f-reg" placeholder="ØªØ³Ø¬ÙŠÙ„">
                <input type="number" id="f-card" placeholder="Ø¨Ø·Ø§Ù‚Ø©">
                <input type="number" id="f-study" placeholder="Ø¯Ø±Ø§Ø³Ø©">
                <input type="number" id="f-disc" placeholder="ØªØ®ÙÙŠØ¶">
            </div>
            <button class="btn btn-dark" style="width:100%; margin-top:10px;" onclick="addStudent()">Ø­ÙØ¸ ÙˆØ¥Ø±Ø³Ø§Ù„ Ù„Ù„Ø³Ø­Ø§Ø¨Ø©</button>
        </div>
        <input type="text" id="r-search" placeholder="Ø¨Ø­Ø« Ø¨Ø§Ù„Ø±Ù‚Ù… Ø£Ùˆ Ø§Ù„Ø§Ø³Ù…..." onkeyup="render()">
        <table>
            <thead><tr><th>Ø§Ù„Ø±Ù‚Ù…</th><th>Ø§Ù„Ø§Ø³Ù…</th><th>Ø§Ù„Ù‚Ø³Ù…</th><th>Ø­Ø§Ù„Ø© Ø§Ù„Ø³Ø¯Ø§Ø¯</th><th>Ø­Ø§Ù„Ø© Ø§Ù„ØªØ³Ø¬ÙŠÙ„</th></tr></thead>
            <tbody id="r-tbody"></tbody>
        </table>
    </div>

    <div id="fin-sec" class="section hidden">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
            <h1 class="welcome-msg" style="border:none; margin:0">ğŸ’° Ù…ÙƒØªØ¨ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª</h1>
            <button class="btn btn-dark" onclick="openReportModal()">ğŸ“Š ØªÙ‚Ø§Ø±ÙŠØ± Ø¥Ø¯Ø§Ø±ÙŠØ©</button>
        </div>
        <div class="dept-filters">
            <button class="btn-filter active" onclick="filterByDept('Ø§Ù„ÙƒÙ„', this, 'fin')">Ø§Ù„ÙƒÙ„</button>
            <button class="btn-filter" onclick="filterByDept('ØªÙ‚Ø§Ù†Ø© Ù†Ø¸Ù… Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª', this, 'fin')">Ù†Ø¸Ù… Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª</button>
            <button class="btn-filter" onclick="filterByDept('Ø§Ù„Ù‡Ù†Ø¯Ø³Ø© Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠØ©', this, 'fin')">ÙƒÙ‡Ø±Ø¨Ø§Ø¡</button>
            <button class="btn-filter" onclick="filterByDept('Ø§Ù„Ù‡Ù†Ø¯Ø³Ø© Ø§Ù„Ù…ÙŠÙƒØ§Ù†ÙŠÙƒÙŠØ©', this, 'fin')">Ù…ÙŠÙƒØ§Ù†ÙŠÙƒØ§</button>
        </div>
        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:15px; margin-bottom:15px">
             <input type="text" id="f-search" placeholder="Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„Ù…Ø§Ù„ÙŠ..." onkeyup="render()">
             <input type="text" id="p-search" placeholder="Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±..." onkeyup="render()">
        </div>
        <div id="inbox-list"></div>
        <hr>
        <h3>ğŸ“Š Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¹Ø§Ù…</h3>
        <table>
            <thead>
                <tr><th>Ø§Ù„Ø±Ù‚Ù…</th><th>Ø§Ù„Ø§Ø³Ù…</th><th>Ø§Ù„Ù…Ø·Ù„ÙˆØ¨</th><th>Ù…Ø¯ÙÙˆØ¹</th><th>Ø­Ø§Ù„Ø© Ø§Ù„Ø³Ø¯Ø§Ø¯</th><th>Ø­Ø§Ù„Ø© Ø§Ù„ØªØ³Ø¬ÙŠÙ„</th><th>Ø¥ÙŠØµØ§Ù„</th></tr>
            </thead>
            <tbody id="f-tbody"></tbody>
        </table>
    </div>
</div>

<script>
    // Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª - Ø¶Ø¹ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ù‡Ù†Ø§
    const CLOUD_URL = "https://script.google.com/macros/s/AKfycbyOBGvyO1tZQM3NQsbwcw-ziFQoEJ01y_NrowstbhBnVrQYYIIpGwpYel9pjkL2ofYX/exec";
    const SUPABASE_URL = "SUPABASE_URL=https://xfbhnagbtwaiiitpeula.supabase.co";
    const SUPABASE_KEY = "SUPABASE_KEY=sb_publishable__VhZu3jnCbrBPjJxe2zmEg__rzYOzKS";

    let db = [];
    let requests = [];
    let currentRegFilter = "Ø§Ù„ÙƒÙ„";
    let currentFinFilter = "Ø§Ù„ÙƒÙ„";

    const majorMap = {
        "ØªÙ‚Ø§Ù†Ø© Ù†Ø¸Ù… Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª": ["ØªÙ‚Ø§Ù†Ø© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª", "Ù†Ø¸Ù… Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø­Ø§Ø³Ø¨ÙŠØ©"],
        "Ø§Ù„Ù‡Ù†Ø¯Ø³Ø© Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠØ©": ["Ø´Ø¨ÙƒØ§Øª Ùˆ ØªÙˆØµÙŠÙ„Ø§Øª"],
        "Ø§Ù„Ù‡Ù†Ø¯Ø³Ø© Ø§Ù„Ù…ÙŠÙƒØ§Ù†ÙŠÙƒÙŠØ©": ["ÙƒÙ‡Ø±Ø¨Ø§Ø¡ Ø³ÙŠØ§Ø±Ø§Øª", "ØªÙƒÙŠÙ ØªØ¨Ø±ÙŠØ¯"]
    };

    async function syncCloud() {
        try {
            const res = await fetch(CLOUD_URL);
            const data = await res.json();
            db = data.students;
            requests = data.requests;
            render();
        } catch (e) { console.error("Error syncing with cloud"); }
    }

    function login() {
        document.getElementById('auth-screen').classList.add('hidden');
        document.getElementById('sidebar').classList.remove('hidden');
        document.getElementById('content').classList.remove('hidden');
        syncCloud();
        setInterval(syncCloud, 10000); 
    }

    // Ø¥Ø¶Ø§ÙØ© Ø·Ø§Ù„Ø¨ (Ø­ÙØ¸ Ù…Ø²Ø¯ÙˆØ¬)
    async function addStudent() {
        const name = document.getElementById('s-name').value;
        const dept = document.getElementById('s-dept').value;
        const major = document.getElementById('s-major').value;
        if(!name || !dept) return alert("Ø£ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");

        const id = (db.length + 2026001).toString();
        const reg = parseFloat(document.getElementById('f-reg').value) || 0;
        const card = parseFloat(document.getElementById('f-card').value) || 0;
        const study = parseFloat(document.getElementById('f-study').value) || 0;
        const disc = parseFloat(document.getElementById('f-disc').value) || 0;
        const total = (reg + card + study) - disc;

        const row = [id, name, dept, major, "ØºÙŠØ± Ù…Ø³Ø¬Ù„", reg, card, study, disc, total, 0, false];
        const sqlData = { student_id: id, name, dept, major, status: "ØºÙŠØ± Ù…Ø³Ø¬Ù„", total, paid: 0 };

        try {
            await Promise.all([
                fetch(CLOUD_URL, { method: 'POST', body: JSON.stringify({ action: 'add', target: 'students', row: row }) }),
                fetch(`${SUPABASE_URL}/rest/v1/students`, {
                    method: 'POST',
                    headers: { 'apikey': SUPABASE_KEY, 'Authorization': `Bearer ${SUPABASE_KEY}`, 'Content-Type': 'application/json' },
                    body: JSON.stringify(sqlData)
                })
            ]);
            alert("ØªÙ… Ø§Ù„Ø­ÙØ¸ ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù…ÙŠÙ† Ø¨Ù†Ø¬Ø§Ø­ âœ…");
            toggle('add-box');
            syncCloud();
        } catch (e) { alert("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­ÙØ¸ Ø§Ù„Ø³Ø­Ø§Ø¨ÙŠ"); }
    }

    // ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø³Ø¯Ø§Ø¯ (ØªØ­Ø¯ÙŠØ« Ù…Ø²Ø¯ÙˆØ¬)
    async function approvePayment(idx) {
        const student = db[idx];
        try {
            await Promise.all([
                fetch(CLOUD_URL, { method: 'POST', body: JSON.stringify({ action: 'update_payment', target: 'students', id: student.id, paid: student.total }) }),
                fetch(`${SUPABASE_URL}/rest/v1/students?student_id=eq.${student.id}`, {
                    method: 'PATCH',
                    headers: { 'apikey': SUPABASE_KEY, 'Authorization': `Bearer ${SUPABASE_KEY}`, 'Content-Type': 'application/json' },
                    body: JSON.stringify({ paid: student.total, status: "Ù…Ø³Ø¬Ù„", confirmed: true })
                })
            ]);
            syncCloud();
        } catch (e) { alert("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ø¯ÙŠØ«"); }
    }

    // ØªØºÙŠÙŠØ± Ø§Ù„Ø­Ø§Ù„Ø© (ØªØ­Ø¯ÙŠØ« Ù…Ø²Ø¯ÙˆØ¬)
    async function toggleStatus(idx) {
        const student = db[idx];
        const newStatus = (student.status === "Ù…Ø³Ø¬Ù„") ? "ØºÙŠØ± Ù…Ø³Ø¬Ù„" : "Ù…Ø³Ø¬Ù„";
        try {
            await Promise.all([
                fetch(CLOUD_URL, { method: 'POST', body: JSON.stringify({ action: 'toggle_status', target: 'students', id: student.id, value: newStatus }) }),
                fetch(`${SUPABASE_URL}/rest/v1/students?student_id=eq.${student.id}`, {
                    method: 'PATCH',
                    headers: { 'apikey': SUPABASE_KEY, 'Authorization': `Bearer ${SUPABASE_KEY}`, 'Content-Type': 'application/json' },
                    body: JSON.stringify({ status: newStatus })
                })
            ]);
            syncCloud();
        } catch (e) { alert("Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø©"); }
    }

    // Ø¨Ù‚ÙŠØ© Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© (Ø¨Ø¯ÙˆÙ† ØªØºÙŠÙŠØ±)
    async function submitSupportRequest(type) {
        let name = type === 'ØªÙØ¹ÙŠÙ„ Ø­Ø³Ø§Ø¨' ? document.getElementById('reg-name').value : "Ù…Ø³ØªØ®Ø¯Ù…";
        let email = type === 'ØªÙØ¹ÙŠÙ„ Ø­Ø³Ø§Ø¨' ? document.getElementById('reg-email').value : document.getElementById('f-email').value;
        const code = Math.floor(1000 + Math.random() * 9000);
        await fetch(CLOUD_URL, { method: 'POST', body: JSON.stringify({ action: 'add', target: 'requests', row: [type, name, email, code, new Date().toLocaleString()] }) });
        alert("ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨");
        hideAuthAction();
        syncCloud();
    }
    async function deleteRequest(code) {
        await fetch(CLOUD_URL, { method: 'POST', body: JSON.stringify({ action: 'delete_req', target: 'requests', code: code }) });
        syncCloud();
    }
    function render() {
        const hQ = document.getElementById('h-search').value.toLowerCase();
        const rQ = document.getElementById('r-search').value.toLowerCase();
        const fQ = document.getElementById('f-search').value.toLowerCase();
        const pQ = document.getElementById('p-search').value.toLowerCase();
        document.getElementById('h-tbody').innerHTML = db.filter(s => s.name.toLowerCase().includes(hQ) || s.id.toString().includes(hQ)).map(s => `<tr><td>${s.id}</td><td>${s.name}</td><td>${s.dept}</td><td><span class="status-badge ${s.status === 'Ù…Ø³Ø¬Ù„'?'st-registered':'st-not-registered'}">${s.status}</span></td></tr>`).join('');
        const regList = db.filter(s => (currentRegFilter === "Ø§Ù„ÙƒÙ„" || s.dept === currentRegFilter) && (s.name.toLowerCase().includes(rQ) || s.id.toString().includes(rQ)));
        document.getElementById('r-tbody').innerHTML = regList.map(s => `<tr><td>${s.id}</td><td>${s.name}</td><td>${s.dept}</td><td style="color:${(s.confirmed==true || s.confirmed=='true')?'green':'orange'}">${(s.confirmed==true || s.confirmed=='true')?'Ù…Ø¹ØªÙ…Ø¯':'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©'}</td><td><b>${s.status}</b></td></tr>`).join('');
        const pending = db.filter(s => (s.confirmed==false || s.confirmed=='false') && (s.name.toLowerCase().includes(pQ) || s.id.toString().includes(pQ)));
        document.getElementById('inbox-list').innerHTML = pending.map(s => `<div class="pending-card"><div><b>${s.name}</b> (Ø±Ù‚Ù…: ${s.id}) <br><small>${s.dept} | Ø§Ù„Ù…Ø·Ù„ÙˆØ¨: ${s.total}</small></div><button class="btn btn-gold" onclick="approvePayment(${db.indexOf(s)})">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø³Ø¯Ø§Ø¯ âœ…</button></div>`).join('');
        const finList = db.filter(s => (currentFinFilter === "Ø§Ù„ÙƒÙ„" || s.dept === currentFinFilter) && (s.name.toLowerCase().includes(fQ) || s.id.toString().includes(fQ)));
        document.getElementById('f-tbody').innerHTML = finList.map(s => `<tr><td>${s.id}</td><td>${s.name}</td><td>${s.total}</td><td>${s.paid}</td><td>${(s.confirmed==true || s.confirmed=='true')?'âœ…':'â³'}</td><td><button class="btn btn-dark" style="font-size:0.7rem" onclick="toggleStatus(${db.indexOf(s)})">${s.status}</button></td><td>${(s.confirmed==true || s.confirmed=='true') ? `<button class="btn btn-gold" style="padding:2px 8px" onclick="printReceiptData(${db.indexOf(s)})">ğŸ–¨ï¸ Ø¥ÙŠØµØ§Ù„</button>` : 'Ø§Ù†ØªØ¸Ø§Ø±'}</td></tr>`).join('');
        document.getElementById('requests-list').innerHTML = requests.map(r => `<div class="pending-card"><span><b>${r.type}</b>: ${r.name} (Ø§Ù„ÙƒÙˆØ¯: ${r.code})</span><button class="btn btn-gold" onclick="deleteRequest('${r.code}')">Ù…ÙˆØ§ÙÙ‚Ø©</button></div>`).join('') || "Ø§Ù„Ø¨Ø±ÙŠØ¯ ÙØ§Ø±Øº";
    }
    function syncMajors(t, s) {
        const d = document.getElementById(s).value;
        const m = document.getElementById(t);
        let opts = t === 'rep-major-select' ? '<option value="Ø§Ù„ÙƒÙ„">ÙƒÙ„ Ø§Ù„ØªØ®ØµØµØ§Øª</option>' : '';
        opts += (majorMap[d] || []).map(x => `<option value="${x}">${x}</option>`).join('');
        m.innerHTML = opts;
    }
    function showSec(id) { document.querySelectorAll('.section').forEach(s => s.classList.add('hidden')); document.getElementById(id).classList.remove('hidden'); }
    function toggle(id) { document.getElementById(id).classList.toggle('hidden'); }
    function showAuthAction(id) { document.querySelectorAll('#login-box, #register-box, #forgot-box').forEach(b => b.classList.add('hidden')); document.getElementById(id).classList.remove('hidden'); }
    function hideAuthAction() { showAuthAction('login-box'); }
    function openAdminPanel() { if(prompt("ÙƒÙ„Ù…Ø© Ø³Ø± Ø§Ù„Ø£Ø¯Ù…Ù†:") === "admin123") toggle('admin-modal'); }
    function filterByDept(d, btn, section) {
        if(section === 'reg') { currentRegFilter = d; document.querySelectorAll('#reg-sec .btn-filter').forEach(b => b.classList.remove('active')); } 
        else { currentFinFilter = d; document.querySelectorAll('#fin-sec .btn-filter').forEach(b => b.classList.remove('active')); }
        btn.classList.add('active'); render();
    }
    function printReceiptData(idx) {
        const s = db[idx];
        document.getElementById('p-id').innerText = s.id;
        document.getElementById('p-name').innerText = s.name;
        document.getElementById('p-dept').innerText = s.dept;
        document.getElementById('p-total').innerText = s.total;
        document.getElementById('p-paid').innerText = s.paid;
        document.getElementById('p-date').innerText = new Date().toLocaleDateString();
        window.print();
    }
    function openReportModal() { toggle('report-modal'); }
    function generateAndPrintReport() {
        const dept = document.getElementById('rep-dept-select').value;
        const major = document.getElementById('rep-major-select').value;
        const status = document.getElementById('rep-status-select').value;
        const reportData = db.filter(s => (dept === "Ø§Ù„ÙƒÙ„" || s.dept === dept) && (major === "Ø§Ù„ÙƒÙ„" || s.major === major) && (status === "Ø§Ù„ÙƒÙ„" || s.status === status));
        document.getElementById('rep-header-dept').innerText = dept;
        document.getElementById('rep-header-date').innerText = new Date().toLocaleDateString();
        document.getElementById('rep-count').innerText = reportData.length;
        document.getElementById('rep-print-body').innerHTML = reportData.map(s => `<tr><td>${s.id}</td><td>${s.name}</td><td>${s.dept}</td><td>${s.major}</td><td>${s.status}</td><td>${s.paid}/${s.total}</td></tr>`).join('');
        document.body.classList.add('print-report-mode'); window.print(); document.body.classList.remove('print-report-mode');
    }
    function googleAuth() { alert("Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù‚ÙˆÙ‚Ù„..."); setTimeout(login, 1000); }
</script>
</body>
</html>